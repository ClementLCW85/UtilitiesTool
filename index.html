<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seapark Block E Utility Tracker</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <h1>Seapark Apartment Block E - Utility Tracker</h1>
        <nav>
            <ul>
                <li><a href="#dashboard">Dashboard</a></li>
                <li><a href="#admin">Admin</a></li>
            </ul>
        </nav>
    </header>

    <main id="app">
        <!-- Public Dashboard Section -->
        <section id="dashboard" class="view-section">
            <h2>Public Dashboard</h2>
            
            <div id="stats-overview" class="stats-grid">
                <div class="stat-card">
                    <h3>Global Break-Even</h3>
                    <p id="stat-total-bills" class="stat-value">Loading...</p>
                    <span class="stat-label">Total Bills to Date</span>
                </div>
                <div class="stat-card">
                    <h3>Target Per Unit</h3>
                    <p id="stat-unit-target" class="stat-value">Loading...</p>
                    <span class="stat-label">Share (1/44)</span>
                </div>
                <div class="stat-card">
                    <h3>Total Collected</h3>
                    <p id="stat-total-collected" class="stat-value">Loading...</p>
                    <span class="stat-label">From 44 Units</span>
                </div>
                <div class="stat-card">
                    <h3>Status</h3>
                    <p id="stat-status" class="stat-value">Loading...</p>
                    <span class="stat-label">Deficit / Surplus</span>
                </div>
            </div>

            <div id="chart-controls" style="text-align: center; margin-bottom: 10px;">
                <label>Filter by Floor: </label>
                <button class="floor-btn active" data-floor="all">All</button>
                <button class="floor-btn" data-floor="1">Level 1</button>
                <button class="floor-btn" data-floor="2">Level 2</button>
                <button class="floor-btn" data-floor="3">Level 3</button>
                <button class="floor-btn" data-floor="4">Level 4</button>
            </div>

            <div id="chart-container">
                <p id="chart-loading-msg">Loading chart...</p>
                <div class="chart-scroll-wrapper">
                    <canvas id="unit-bar-chart"></canvas>
                </div>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin" class="view-section" style="display:none;">
            <h2>Admin Interface</h2>
            
            <!-- Login State -->
            <div id="admin-login">
                <h3>Restricted Access</h3>
                <form id="login-form">
                    <div class="form-group">
                        <label for="admin-password">Master Password:</label>
                        <input type="password" id="admin-password" required placeholder="Enter Admin Password">
                    </div>
                    <button type="submit">Login</button>
                    <p class="small-note">Note: Uses Firebase Auth (your admin email)</p>
                </form>
            </div>

            <!-- Authenticated State -->
            <div id="admin-content" style="display:none;">
                <div class="admin-header">
                    <span>Welcome, Admin</span>
                    <button id="logout-btn">Logout</button>
                </div>
                
                <div class="admin-panel">
                    <h3>Management Options</h3>
                    <form id="bill-form" class="admin-form">
                        <fieldset>
                            <legend>Record New Electric Bill</legend>
                            <div class="form-group">
                                <label for="bill-month">Month:</label>
                                <select id="bill-month" required>
                                    <option value="">--Select--</option>
                                    <option value="1">January</option>
                                    <option value="2">February</option>
                                    <option value="3">March</option>
                                    <option value="4">April</option>
                                    <option value="5">May</option>
                                    <option value="6">June</option>
                                    <option value="7">July</option>
                                    <option value="8">August</option>
                                    <option value="9">September</option>
                                    <option value="10">October</option>
                                    <option value="11">November</option>
                                    <option value="12">December</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="bill-year">Year:</label>
                                <input type="number" id="bill-year" min="2020" max="2100" required placeholder="e.g. 2024">
                            </div>
                            <div class="form-group">
                                <label for="bill-amount">Total Amount (RM):</label>
                                <input type="number" id="bill-amount" min="0" step="0.01" required placeholder="e.g. 123.45">
                            </div>
                            <div class="form-group">
                                <label for="bill-date">Bill Issue Date:</label>
                                <input type="date" id="bill-date" required>
                            </div>
                            <button type="submit">Save Bill</button>
                            <span id="bill-form-status" class="small-note"></span>
                        </fieldset>
                    </form>
                    <hr>
                    <section id="bill-history-section">
                        <h3>Bill History</h3>
                        <div class="table-wrapper">
                            <table id="bill-history-table">
                                <thead>
                                    <tr>
                                        <th>Month</th>
                                        <th>Year</th>
                                        <th>Amount (RM)</th>
                                        <th>Issue Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Bill rows will be dynamically inserted here -->
                                </tbody>
                            </table>
                        </div>
                        <span id="bill-history-status" class="small-note"></span>
                    </section>
                    <p id="payment-placeholder" style="display:none;">Select an action below (Pending Implementation in PAY-1)</p>
                    <div class="admin-actions" style="display:none;">
                        <button disabled>Record Payment</button>
                    </div>

                    <form id="payment-form" class="admin-form">
                        <fieldset>
                            <legend>Record Unit Payment</legend>
                            <div class="form-group">
                                <label for="payment-unit">Unit Number:</label>
                                <select id="payment-unit" required>
                                    <option value="">--Select Unit--</option>
                                    <!-- Options will be populated by JS -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="payment-amount">Amount (RM):</label>
                                <input type="number" id="payment-amount" min="0" step="0.01" required placeholder="e.g. 50.00">
                            </div>
                            <div class="form-group">
                                <label for="payment-date">Date:</label>
                                <input type="date" id="payment-date" required>
                            </div>
                            <div class="form-group">
                                <label for="payment-ref">Reference/Note (Optional):</label>
                                <input type="text" id="payment-ref" placeholder="e.g. Oct Contribution">
                            </div>
                            <div class="form-group">
                                <label for="payment-receipt">Receipt Link (Optional):</label>
                                <input type="url" id="payment-receipt" placeholder="e.g. https://drive.google.com/...">
                            </div>
                            <button type="submit">Record Payment</button>
                            <span id="payment-form-status" class="small-note"></span>
                        </fieldset>
                    </form>
                    
                    <hr>
                    <section id="payment-history-section">
                        <h3>Payment History per Unit</h3>
                        <div class="form-group">
                            <label for="history-unit-select">Select Unit to View:</label>
                            <select id="history-unit-select">
                                <option value="">--Select Unit--</option>
                                <!-- populated by JS -->
                            </select>
                        </div>
                        <div class="table-wrapper">
                            <table id="payment-history-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Amount (RM)</th>
                                        <th>Reference</th>
                                        <th>Receipt</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="4">Select a unit to view history.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <hr>
                    <section id="unit-management-section">
                        <h3>Unit Status Management</h3>
                        <form id="unit-status-form" class="admin-form">
                            <fieldset>
                                <legend>Edit Unit Status</legend>
                                <div class="form-group">
                                    <label for="admin-unit-select">Select Unit:</label>
                                    <select id="admin-unit-select" required>
                                        <option value="">--Select Unit--</option>
                                        <!-- populated by JS -->
                                    </select>
                                </div>
                                <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="unit-highlight-check" style="width: auto;"> 
                                    <label for="unit-highlight-check" style="margin: 0; display: inline;">Highlight Unit (Special Status)</label>
                                </div>
                                <div class="form-group">
                                    <label for="unit-note-input">Public Note:</label>
                                    <input type="text" id="unit-note-input" placeholder="e.g. Hardship Exemption">
                                </div>
                                <button type="submit">Update Unit Status</button>
                                <span id="unit-status-form-status" class="small-note"></span>
                            </fieldset>
                        </form>
                    </section>

                    <hr>
                    <section id="system-config-section">
                        <h3>System Configuration</h3>
                        <form id="threshold-form" class="admin-form">
                            <fieldset>
                                <legend>Manual Threshold Override</legend>
                                <p class="small-note">Overrides the auto-calculated break-even target per unit.</p>
                                
                                <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="threshold-override-check" style="width: auto;"> 
                                    <label for="threshold-override-check" style="margin: 0; display: inline;">Enable Manual Override</label>
                                </div>

                                <div class="form-group">
                                    <label for="threshold-amount">Manual Target Amount (RM):</label>
                                    <input type="number" id="threshold-amount" min="0" step="0.01" placeholder="e.g. 100.00" disabled>
                                </div>

                                <button type="submit">Save Threshold Settings</button>
                                <span id="threshold-form-status" class="small-note"></span>
                            </fieldset>
                        </form>
                    </section>

                    <hr>
                    <section id="data-export-section">
                        <h3>Data Backup</h3>
                        <div class="admin-form">
                            <fieldset>
                                <legend>Export System Data</legend>
                                <p class="small-note">Download a copy of all Bills and Payments.</p>
                                <button id="export-data-btn" type="button" style="background-color: #28a745;">Download Data (JSON)</button>
                                <span id="export-status" class="small-note"></span>
                            </fieldset>
                        </div>
                    </section>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; Seapark Block E Management</p>
    </footer>

    <!-- Firebase SDKs (using version 10.7.1 compat for simpler script tag usage without bundlers, or standard modular via module scripts) -->
    <!-- Utilizing the numbered version to ensure stability. Using compat libraries for easier standalone script usage without a build step. -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- App Scripts -->
    <script src="js/config.js"></script>
    <script src="js/db.js"></script>
    <script src="js/models.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
